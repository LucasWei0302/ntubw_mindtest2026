<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>點亮你的潛在天賦 - 測驗結果</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

    <style>
        :root { --bg: #FFFBEB; --text: #5B4636; }
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .result-card {
            background: white; border-radius: 30px;
            padding: 40px;
            max-width: 800px; width: 100%;
            text-align: center;
            box-shadow: 0 15px 40px rgba(91, 70, 54, 0.15);
            box-sizing: border-box;
            overflow: hidden;
        }
        h1 { color: {{ result.color }}; margin: 10px 0 20px 0; font-size: 2rem; }

        .chart-container {
            position: relative;
            height: 450px;
            width: 100%;
            margin: 20px auto;
        }

        .desc {
            background: #F9F9F9; padding: 25px; border-radius: 20px;
            text-align: justify; line-height: 1.8; color: #666; margin-bottom: 30px;
            font-size: 1.1rem;
        }
        .btn-restart {
            background-color: #5B4636; color: white; padding: 15px 50px;
            border-radius: 50px; text-decoration: none; display: inline-block;
            font-size: 1.2rem; transition: 0.3s;
        }
        .btn-restart:hover { opacity: 0.9; transform: translateY(-2px);}

        @media (max-width: 600px) {
            /* 手機版改成 320px 正方形比例，避免過高導致寬度被擠壓 */
            .chart-container { height: 320px; }
            .result-card { padding: 25px 15px; }
            h1 { font-size: 1.6rem; }
            .desc { padding: 20px; font-size: 1rem;}
        }
    </style>
</head>
<body>
    <div class="result-card">
        <h1>{{ result.title }}</h1>

        <div class="chart-container">
            <canvas id="radarChart"></canvas>
        </div>

        <div class="desc">{{ result.desc }}</div>
        <a href="{{ url_for('home') }}" class="btn-restart">再測一次</a>
    </div>

    <script>
        try {
            Chart.register(ChartDataLabels);

            const scores = {
                '真誠關懷感染力': {{ scores['真誠關懷感染力'] }},
                '邏輯覺察判斷力': {{ scores['邏輯覺察判斷力'] }},
                '抗壓成長行動力': {{ scores['抗壓成長行動力'] }}
            };

            const isMobile = window.innerWidth < 600;

            // 【重點修改】定義標籤：如果是手機版，將文字拆成兩行 (用陣列表示)
            const rawLabels = ['真誠關懷感染力', '邏輯覺察判斷力', '抗壓成長行動力'];
            const chartLabels = isMobile ? [
                ['真誠關懷', '感染力'],
                ['邏輯覺察', '判斷力'],
                ['抗壓成長', '行動力']
            ] : rawLabels;

            const ctx = document.getElementById('radarChart');

            const radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: chartLabels, // 使用處理過的標籤
                    datasets: [{
                        label: '能力分佈',
                        data: [scores['真誠關懷感染力'], scores['邏輯覺察判斷力'], scores['抗壓成長行動力']],
                        backgroundColor: '{{ result.color }}33',
                        borderColor: '{{ result.color }}',
                        pointBackgroundColor: '{{ result.color }}',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '{{ result.color }}',
                        borderWidth: 3,
                        pointRadius: isMobile ? 4 : 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        // 增加內距，強迫圖表縮小一點，留位置給文字
                        padding: {
                            top: 10,
                            bottom: 10,
                            left: isMobile ? 5 : 20,
                            right: isMobile ? 5 : 20
                        }
                    },
                    scales: {
                        r: {
                            angleLines: { display: true, color: '#e0e0e0' },
                            grid: { color: '#f0f0f0' },
                            suggestedMin: 0,
                            suggestedMax: 10,
                            pointLabels: {
                                // 手機字體改小一點 (12px)
                                font: { size: isMobile ? 12 : 16, family: "'Zen Maru Gothic', sans-serif", weight: 'bold' },
                                color: '#5B4636',
                                // 減少文字與圖的距離，讓結構緊湊一點
                                padding: isMobile ? 5 : 15
                            },
                            ticks: {
                                display: true,
                                stepSize: 2,
                                color: '#ccc',
                                backdropColor: 'transparent',
                                font: { size: 9 } // 刻度字體也縮小
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            color: '{{ result.color }}',
                            font: {
                                weight: 'bold',
                                size: isMobile ? 13 : 16,
                                family: "'Zen Maru Gothic', sans-serif"
                            },
                            anchor: 'end',
                            align: 'end',
                            offset: isMobile ? 2 : 4, // 手機版數字離點近一點
                            textStrokeColor: 'white',
                            textStrokeWidth: 4
                        }
                    }
                }
            });
        } catch (error) {
            console.error("圖表繪製失敗:", error);
        }
    </script>
</body>
</html>